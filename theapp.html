<!-- This is the HTML part -->
<!-- This is where the output image will be shown -->
<img id="output-image">

<!-- This is where the file input element will be shown -->
<input type="file" id="picture-picker" accept="image/*">

<!-- This is where the number input element will be shown -->
<input type="number" id="scale-input" min="1" max="10" value="4">

<!-- This is where the checkbox input element will be shown -->
<input type="checkbox" id="face-enhance-input" checked>
<script>
// This is the JavaScript part
// Import Replicate from replicate-js module
import Replicate from 'replicate-js'

// Create a new Replicate instance with your API token or a proxy URL
const replicate = new Replicate({token: '9876b5f71cafb8fa758cafb8895d6e4d3d69ca80'})

// Get the nightmare ai model from Replicate
const nightmareModel = await replicate.models.get('nightmareai/real-esrgan')

// Get the file input element by its id
const picturePicker = document.getElementById('picture-picker')

// Get the image element by its id
const outputImage = document.getElementById('output-image')

// Get the number input element by its id
const scaleInput = document.getElementById('scale-input')

// Get the checkbox input element by its id
const faceEnhanceInput = document.getElementById('face-enhance-input')

// Add an event listener to handle the change event when a file is selected
picturePicker.addEventListener('change', async function() {
  // Get the first file from the input element
  const file = this.files[0]

  // Create a new FileReader object to read the file as a data URL
  const reader = new FileReader()

  // Add an event listener to handle the load event when the file is read
  reader.addEventListener('load', async function() {
    // Get the data URL from the reader result
    const dataURL = this.result

    // Validate the scale input value and set it to 4 if it is invalid
    let scale = parseInt(scaleInput.value)
    if (isNaN(scale) || scale < 1 || scale > 10) {
      scale = 4
      scaleInput.value = 4
    }

    // Get the face enhance input checked state
    let faceEnhance = faceEnhanceInput.checked

    // Predict an image using the model with some parameters
    const nightmareImage = await nightmareModel.predict({image: dataURL, scale: scale, face_enhance: faceEnhance})

    // Set the source attribute of the image element to the output image
    outputImage.src = nightmareImage
  })

  // Read the file as a data URL
  reader.readAsDataURL(file)
})
</script>